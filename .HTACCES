# FILE: .htaccess (di root folder kantin-digital/)
# Aktifkan rewrite engine
RewriteEngine On

# ============================================
# HANDLING ROOT URL
# ============================================

# Redirect root ke handler (index.php)
DirectoryIndex index.php

# Jika akses langsung folder public, redirect ke index
RewriteRule ^public/?$ public/index.php [L]

# ============================================
# ERROR PAGES
# ============================================
ErrorDocument 404 /kantin-digital/public/404.php
ErrorDocument 403 /kantin-digital/public/403.php

# ============================================
# PROTECT SENSITIVE FILES
# ============================================

# Protect .htaccess itu sendiri
<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>

# Protect file sensitif
<FilesMatch "\.(sql|log|ini|bak|config|yml|json|lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect folder sensitif
RewriteRule ^(core|kunci|vendor)/ - [F,L]

# ============================================
# URL REWRITING (Pretty URLs)
# ============================================

# Redirect /menu ke public/index.php#menu
RewriteRule ^menu/?$ public/index.php#menu [NE,L]

# Redirect /cart ke public/cart/index.php
RewriteRule ^cart/?$ public/cart/index.php [L]

# Redirect /profile ke public/profile.php
RewriteRule ^profile/?$ public/profile.php [L]

# Redirect /orders ke public/orders.php
RewriteRule ^orders/?$ public/orders.php [L]

# Redirect /wishlist ke public/wishlist.php
RewriteRule ^wishlist/?$ public/wishlist.php [L]

# Redirect /about ke public/about.php
RewriteRule ^about/?$ public/about.php [L]

# Redirect /contact ke public/contact.php
RewriteRule ^contact/?$ public/contact.php [L]

# Redirect /faq ke public/faq.php
RewriteRule ^faq/?$ public/faq.php [L]

# Redirect /search ke public/search.php
RewriteRule ^search/?$ public/search.php [L]

# ============================================
# AUTH REDIRECTS
# ============================================

# Redirect /login ke auth/login.php
RewriteRule ^login/?$ auth/login.php [L]

# Redirect /register ke auth/register.php
RewriteRule ^register/?$ auth/register.php [L]

# Redirect /logout ke auth/logout.php
RewriteRule ^logout/?$ auth/logout.php [L]

# ============================================
# ADMIN REDIRECTS
# ============================================

# Redirect /admin ke admin/dashboard.php (dengan proteksi)
RewriteRule ^admin/?$ admin/dashboard.php [L]

# ============================================
# CACHE CONTROL
# ============================================

# Cache gambar dan CSS/JS
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    
    # CSS, JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    
    # Fonts
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# ============================================
# COMPRESSION (GZIP)
# ============================================
<IfModule mod_deflate.c>
    # Compress HTML, CSS, JavaScript, Text, XML and fonts
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE font/ttf
    AddOutputFilterByType DEFLATE font/otf
    
    # Remove browser bugs
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    Header append Vary User-Agent
</IfModule>

# ============================================
# SECURITY HEADERS
# ============================================
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # XSS Protection
    Header set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Frame Options (cegah clickjacking)
    Header set X-Frame-Options "SAMEORIGIN"
</IfModule>

# ============================================
# PHP SETTINGS (jika diizinkan)
# ============================================
<IfModule mod_php7.c>
    # Maximum upload size
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    
    # Maximum execution time
    php_value max_execution_time 300
    
    # Session settings
    php_value session.gc_maxlifetime 86400
    php_value session.cookie_lifetime 0
    php_value session.cookie_httponly 1
    php_value session.use_strict_mode 1
    
    # Timezone
    php_value date.timezone Asia/Jakarta
</IfModule>

# ============================================
# DIRECTORY LISTING - MATIKAN
# ============================================
Options -Indexes

# ============================================
# CUSTOM REDIRECTS
# ============================================

# Redirect dari HTTP ke HTTPS (uncomment jika pakai SSL)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}/kantin-digital/$1 [R=301,L]

# Redirect www ke non-www (optional)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ http://%1/kantin-digital/$1 [R=301,L]